<!DOCTYPE html>
<html>
<head>
<title>Owner Statement</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
body { background:#0f172a; color:#e5e7eb; font-family:Arial; padding:40px; }
h1 { text-align:center; font-size:40px; letter-spacing:2px; }
.owner { text-align:center; font-size:32px; color:#facc15; margin-top:10px; }
.period { text-align:center; margin-bottom:40px; color:#9ca3af; }
input,select { padding:8px; margin:5px; }
button { padding:10px 20px; background:#2563eb; border:none; color:white; }
.kpi { display:flex; justify-content:space-between; margin-top:30px; }
.kpi div { text-align:center; flex:1; }
.kpi span { display:block; font-size:28px; margin-top:8px; }
.section { margin-top:40px; }
.property-title { font-size:22px; margin-top:30px; }
.address { color:#9ca3af; margin-bottom:10px; }
table { width:100%; border-collapse:collapse; margin-top:10px; background:#111827; }
th,td { padding:8px; border:1px solid #1f2937; text-align:right; }
th { background:#1f2937; }
td.left { text-align:left; }
hr { border:1px solid #1f2937; margin-top:40px; }
</style>
</head>

<body>

<h1>OWNER STATEMENT</h1>

<label>Owner Name:</label>
<input type="text" id="ownerName" value="ERAN"><br>

<label>Period Start:</label>
<input type="date" id="startDate">
<label>End:</label>
<input type="date" id="endDate"><br>

<label>Management %</label>
<input type="number" id="percent" value="12">

<select id="ownerType">
<option value="pmc">PMC Holds Payout</option>
<option value="direct">Owner Paid Directly</option>
</select>

<br><br>
<input type="file" id="csvFile" accept=".csv">
<button onclick="run()">Generate Statement</button>

<div id="statement"></div>

<script>

function n(v){ return parseFloat((v||"0").toString().replace(/[$,]/g,''))||0; }

function stay(i,o){
 if(!i||!o) return "";
 let a=i.split("-"), b=o.split("-");
 return a[1]+"/"+a[2]+" - "+b[1]+"/"+b[2];
}

function run(){

let file=document.getElementById("csvFile").files[0];
let percent=parseFloat(document.getElementById("percent").value)/100;
let ownerType=document.getElementById("ownerType").value;
let owner=document.getElementById("ownerName").value;
let start=document.getElementById("startDate").value;
let end=document.getElementById("endDate").value;

if(!file){ alert("Upload CSV"); return; }

Papa.parse(file,{
header:true,
skipEmptyLines:true,
complete:function(res){

let data=res.data;
let grouped={};

let gross=0, cleaningTotal=0, mgmtTotal=0, expenseTotal=0, netTotal=0, draftTotal=0;

data.forEach(r=>{

if(n(r["CANCELED TOTAL PAYOUT"])!==0) return;

let listing=r["LISTING'S NICKNAME"]||"Unknown";
if(!grouped[listing]) grouped[listing]=[];

grouped[listing].push(r);

});

let html="";
html+="<div class='owner'>"+owner+"</div>";
html+="<div class='period'>"+start+" TO "+end+"</div>";

let kpiHTML="<div class='kpi'>";

Object.keys(grouped).forEach(listing=>{

grouped[listing].forEach(r=>{

let payout=n(r["TOTAL PAYOUT"]);
let cleaning=n(r["CLEANING FARE"]);
let acc=n(r["ACCOMMODATION FARE"]);
let adj=n(r["ACCOMMODATION FARE ADJUSTMENT"]);
let markup=n(r["MARKUP"]);
let expense=0; // add later if needed

let trueAcc=(acc+adj)-markup;
let mgmt=trueAcc*percent;
let net=payout-mgmt-cleaning-expense;

gross+=payout;
cleaningTotal+=cleaning;
mgmtTotal+=mgmt;
expenseTotal+=expense;
netTotal+=net;

});

});

if(ownerType==="direct"){
 draftTotal=mgmtTotal+cleaningTotal;
}else{
 draftTotal=netTotal;
}

kpiHTML+="<div>GROSS PAYOUT<span>$"+gross.toFixed(2)+"</span></div>";
kpiHTML+="<div>TOTAL CLEANING<span>$"+cleaningTotal.toFixed(2)+"</span></div>";
kpiHTML+="<div>PMC COMM ("+(percent*100).toFixed(0)+"%)<span>$"+mgmtTotal.toFixed(2)+"</span></div>";
kpiHTML+="<div>EXPENSED<span>$"+expenseTotal.toFixed(2)+"</span></div>";
kpiHTML+="<div>NET REVENUE<span>$"+netTotal.toFixed(2)+"</span></div>";
kpiHTML+="<div>"+(ownerType==="direct"?"DRAFT FROM OWNER":"PAY OWNER")+"<span>$"+draftTotal.toFixed(2)+"</span></div>";
kpiHTML+="</div>";

html+=kpiHTML;
html+="<hr>";

Object.keys(grouped).forEach(listing=>{

html+="<div class='property-title'>üè† "+listing+"</div>";
html+="<div class='address'></div>";

html+="<table><tr>";
html+="<th>ID</th>";
html+="<th>STAY</th>";
html+="<th>GROSS PAYOUT</th>";
html+="<th>CLEANING</th>";
html+="<th>PMC COMM</th>";
html+="<th>EXPENSED</th>";
html+="<th>NET REVENUE</th>";
html+="</tr>";

grouped[listing].forEach(r=>{

let payout=n(r["TOTAL PAYOUT"]);
let cleaning=n(r["CLEANING FARE"]);
let acc=n(r["ACCOMMODATION FARE"]);
let adj=n(r["ACCOMMODATION FARE ADJUSTMENT"]);
let markup=n(r["MARKUP"]);
let expense=0;

let trueAcc=(acc+adj)-markup;
let mgmt=trueAcc*percent;
let net=payout-mgmt-cleaning-expense;

html+="<tr>";
html+="<td class='left'>"+(r["CONFIRMATION CODE"]||"")+"</td>";
html+="<td>"+stay(r["CHECK-IN DATE"],r["CHECK-OUT DATE"])+"</td>";
html+="<td>$"+payout.toFixed(2)+"</td>";
html+="<td>$"+cleaning.toFixed(2)+"</td>";
html+="<td>$"+mgmt.toFixed(2)+"</td>";
html+="<td>$"+expense.toFixed(2)+"</td>";
html+="<td>$"+net.toFixed(2)+"</td>";
html+="</tr>";

});

html+="</table>";

});

document.getElementById("statement").innerHTML=html;

}
});

}

</script>

</body>
</html>
